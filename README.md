# Probability Map–based Grape Detection and Counting
This repository is the official implementation of our paper: [Probability Map–based Grape Detection and Counting](https://www.sciencedirect.com/science/article/pii/S0168169924005660), which has already been accepted by `Computers and Electronics in Agriculture`.

## Datasets
`Datasets used in training and testing of our methods`: [BaiduYun](https://pan.baidu.com/s/1ytr9z5FXEchZ7bpdPCA_Wg), code:36ci (or for anyone outside China: [Google drive](https://drive.google.com/file/d/1sz64-08Fr9S3IdGdhnksRwtJ0JhSo3Sq/view?usp=sharing)).

BC: The BpGC dataset, generated by finding the grape-berry annotations contained in each grape cluster, that is, covered by the mask of each grape cluster, and regard those berries and that cluster as an integral berry-per-grape-cluster annotation. 

WGISD: The ground truth WGISD generated with the method used in 'Decoupled Two-Stage Crowd Counting and Beyond'.

## Weights
`Model weight files`: [BaiduYun](https://pan.baidu.com/s/165fcNHIJNW_e_xNOzvqcGg), code:vzau (or for anyone outside China: [Google drive](https://drive.google.com/file/d/1zQNhLcS6G7I2RlzkfNtUQ82T0s23KHG2/view?usp=sharing)).  

best_ap.pth.tar: The model weight with the best grape-cluster detection performance. 

best_mae.pth.tar: The model weight with the best grape-berry counting performance. 

best_mrd.pth.tar: The model weight with the best berry-per-grape-cluster counting performance. 

## Project Setup
Download the datasets and the model weights, unzip them into the same folder as the source code. Use `'train.py'` to do model training, use `'test_vis.py'` to do evaluation.
